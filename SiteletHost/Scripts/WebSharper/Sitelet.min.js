(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;$.Define($$,{Sitelet:{Review:{Control:$.Class({get_Body:function(){return d.main();}}),Js:{Details:{displayDetail:function(M,N,O){var P,Q,R;if(M.$==1){Q=M.$0;P=[Q,Q.length];}else{P=["NA",0];}R=P[1];e.setText(N,P[0]);return R>0?e.setText(O,"("+$$.String(R)+" characters)"):null;},displayDetails:function(S){e.setText("request-uri",S.RequestUri);e.setText("response-time",$$.String(S.ResponseTime)+" ms");e.setText("text-html-ratio",$$.String(S.TextHtmlRatio)+" %");e.displayTitle(S.Title);e.displayMetaDesc(S.MetaDescription);return e.displayHeadings(S.Headings);},displayHeadings:function(T){var U,V;if(T.get_Length()===0){return e.setText("headings","NA");}else{U=e.navTabs(T);V=e.tabPanes(T);return f("#headings").append(U.Body).append(V.Body);}},displayMetaDesc:function(W){return e.displayDetail(W,"meta-description","meta-description-length");},displayTitle:function(X){return e.displayDetail(X,"title","title-length");},navTab:function(Y,Z,_0){var _1,_2;_2="#headings-tab-"+Z;_1=i.LI(j.ofArray([i.A(j.ofArray([i.Attr().NewAttr("href",_2),k.Attr().NewAttr("data-"+"toggle","tab"),i.Text("H"+_0)]))]));return Y?l.add(_1,j.ofArray([i.Attr().Class("active")])):_1;},navTabs:function(_3){var _4,_6;_4=m.groupBy(function(_5){return _5.Level;},_3);_6=m.mapi(function(_7){return $.Tupled(function(_8){var _9,_,ba;_9=_8[0];_=$$.String(_7+1);ba=$$.String(_9);return _7===0?e.navTab(true,_,ba):e.navTab(false,_,ba);});},m.sortBy($.Tupled(function(ba){return ba[0];}),_4));return l.add(i.UL(j.ofArray([i.Attr().Class("nav nav-tabs")])),_6);},setText:function(bb,bc){n.getElementById(bb).textContent=bc;},tabPane:function(bd,be,bf){var bg,bj;bg=i.Div(j.ofArray([l.add(i.UL(j.ofArray([i.Attr().Class("list-group")])),m.toList(m.delay(function(){return m.map(function(bi){return i.LI(j.ofArray([i.Attr().Class("list-group-item"),i.Text(bi.Text)]));},bf);})))]));bj="headings-tab-"+be;return l.add(bd?l.add(bg,j.ofArray([i.Attr().Class("tab-pane fade in active")])):l.add(bg,j.ofArray([i.Attr().Class("tab-pane fade")])),j.ofArray([i.Attr().NewAttr("id",bj)]));},tabPanes:function(bk){var bl,bn;bl=m.groupBy(function(bm){return bm.Level;},bk);bn=m.mapi(function(bo){return $.Tupled(function(bp){var bq,br;bq=bp[1];br=$$.String(bo+1);return bo===0?e.tabPane(true,br,bq):e.tabPane(false,br,bq);});},m.sortBy($.Tupled(function(bs){return bs[0];}),bl));return l.add(i.Div(j.ofArray([i.Attr().Class("tab-content")])),bn);}},Headers:{displayHeaders:function(bt){var bu;bu=l.add(i.Table(j.ofArray([i.Attr().Class("table table-hover")])),m.toList(m.delay(function(){return m.append([i.TR(j.ofArray([i.TH(j.ofArray([i.Text("Key")])),i.TH(j.ofArray([i.Text("Value")]))]))],m.delay(function(){return m.collect(function(bx){return m.map(function(by){return i.TR(j.ofArray([i.TD(j.ofArray([i.Text(bx.Key)])),i.TD(j.ofArray([i.Text(by)]))]));},bx.Values);},bt);}));})));n.getElementById("headers-panel-body").appendChild(bu.Body);return;}},Hyperlinks:{dataTable:function(bz,bA,bB){var bC;bC=new q();bC.addColumn("string",bz);bC.addColumn("number",bA);bC.addRows(bB.get_Length());m.iteri(function(bD){return $.Tupled(function(bE){var bF;bF=bE[1];bC.setCell(bD,0,bE[0]);return bC.setCell(bD,1,bF);});},bB);return bC;},displayHyperlinks:function(bG){var bH,bJ,bK,bL,bN,bO;bH=j.partition(function(bI){return bI.Type==="External";},bG);bJ=bH[1];bK=bH[0];bL=j.partition(function(bM){return bM.Rel==="Follow";},bG);bN=bL[1];bO=bL[0];r.updateTabHeader("internal-links",$$.String(bJ.get_Length()));r.updateTabHeader("external-links",$$.String(bK.get_Length()));n.getElementById("internal-links-table").appendChild(r.table(bJ).Body);n.getElementById("external-links-table").appendChild(r.table(bK).Body);r.displayStats("Hyperlinks Type","Count",j.ofArray([["External",bK.get_Length()],["Internal",bJ.get_Length()]]),"external-internal-tab");return r.displayStats("Hyperlinks Rel","Count",j.ofArray([["Follow",bO.get_Length()],["NoFollow",bN.get_Length()]]),"follow-nofollow-tab");},displayStats:function(bP,bQ,bR,bS){var bT;bT=r.drawPie(r.dataTable(bP,bQ,bR));n.getElementById(bS).appendChild(bT.Body);return;},drawPie:function(bU){var bV;bV=i.Div($.New(s,{$:0}));(new t(bV.Body)).draw(bU,{height:600,width:600});return bV;},table:function(bW){return l.add(i.Table(j.ofArray([i.Attr().Class("table table-hover")])),m.toList(m.delay(function(){return m.append([i.TR(j.ofArray([i.TH(j.ofArray([i.Text("URL")])),i.TH(j.ofArray([i.Text("Anchor")])),i.TH(j.ofArray([i.Text("Rel")]))]))],m.delay(function(){return m.map(function(bZ){return i.TR(j.ofArray([i.TD(j.ofArray([i.A(j.ofArray([i.HRef(bZ.UriString),i.Text(bZ.UriString)]))])),i.TD(j.ofArray([i.Text(bZ.Anchor)])),i.TD(j.ofArray([i.Text(bZ.Rel)]))]));},bW);}));})));},updateTabHeader:function(b0,b1){var b2;b2=n.getElementById(b0);b2.textContent=b2.textContent+" ("+b1+")";return;}},Keywords:{dataTable:function(b3){var b4;b4=new q();b4.addColumn("string","Combination");b4.addColumn("number","Occurrence");b4.addColumn("number","Density");b4.addRows(b3.get_Length());m.iteri(function(b5){return function(b6){b4.setCell(b5,0,b6.Combination);b4.setCell(b5,1,b6.Occurrence);return b4.setCell(b5,2,b6.Density);};},b3);return b4;},displayKeywords:function(b7){return m.iter(function(b8){return u.keywordsTable(u.filterCount(b7,b8),"keywords-tab-"+$$.String(b8));},m.toList(v.range(1,3)));},filterCount:function(b9,b_){return j.filter(function(b$){return b$.WordsCount===b_;},b9);},keywordsTable:function(ca,cb){var cc,cd;cc=u.dataTable(ca);cd=i.Div($.New(s,{$:0}));(new w(cd.Body)).draw(cc,{sortAscending:false,sortColumn:1,width:"600px"});n.getElementById(cb).appendChild(cd.Body);return;}},Speed:{displayBytesStats:function(ce){return r.displayStats("Bytes","Size",j.ofArray([["CSS",ce.CssBytes],["Flash",ce.FlashBytes],["HTML",ce.HtmlBytes],["Image",ce.ImageBytes],["Other",ce.OtherBytes],["Text",ce.TextBytes]]),"bytes-stats");},displayResourcesStats:function(cf){e.setText("hosts",$$.String(cf.Hosts));e.setText("css-resources",$$.String(cf.CssResources));e.setText("js-resources",$$.String(cf.JsResources));e.setText("static-resources",$$.String(cf.StaticResources));return e.setText("total-resources",$$.String(cf.TotalResources));},displayScore:function(cg){return e.setText("speed-score",$$.String(cg.Score)+" / 100");},displayScreenshot:function(ch){var ci,cj,ck;cj=ch.Uri;ck=ch.Screenshot;ci=l.add(i.A(j.ofArray([i.Attr().NewAttr("href",cj),i.Attr().NewAttr("target","_blank")])),j.ofArray([i.Img(j.ofArray([i.Attr().Class("img-responsive img-thumbnail"),i.Attr().NewAttr("src",ck)]))]));n.getElementById("screenshot").appendChild(ci.Body);return;},displaySuggestions:function(cl){var cm,cn;cm=n.getElementById("suggestions-accordion");cn=j.filter(function(co){return co.Impact>0;},cl);r.updateTabHeader("suggestions-nav-tab",$$.String(cn.get_Length()));return m.iteri(function(cp){return function(cq){cm.appendChild(x.suggestionPanel(cq,cp).Body);};},cn);},suggestionPanel:function(cr,cs){var ct,cu;ct=$$.String(cs);cu="suggestion-"+$$.String(cs);return l.add(i.Div(j.ofArray([i.Attr().Class("panel panel-default")])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("panel-heading")])),j.ofArray([l.add(i.H4(j.ofArray([i.Attr().Class("panel-title")])),j.ofArray([i.A(j.ofArray([i.HRef("#suggestion-"+ct),k.Attr().NewAttr("data-"+"toggle","collapse"),k.Attr().NewAttr("data-"+"parent","#suggestions-accordion"),i.Text(cr.Name)]))]))])),l.add(i.Div(j.ofArray([i.Attr().Class("panel-collapse collapse"),i.Attr().NewAttr("id",cu)])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("panel-body")])),m.toList(m.delay(function(){return m.map(function(cw){return i.Div(j.ofArray([i.Div(m.toList(m.delay(function(){var cy,cz;cy=cw.Hyperlink;if(cy.$==1){cz=cy.$0;return[i.A(j.ofArray([i.Attr().NewAttr("href",cz),i.Attr().NewAttr("target","_blank"),i.Text(cw.Header)]))];}else{return[i.Text(cw.Header)];}}))),i.UL(m.toList(m.delay(function(){return m.map(function(cB){return i.LI(j.ofArray([i.Text(cB)]));},cw.Urls);})))]));},cr.Details);})))]))]));}},UriPiglet:{main:function(){return z.Render(function(cC){return function(cD){return d.view(cC,cD);};},z.Run(function(cE){return c.review(cE);},d.piglet("")));},piglet:function(cF){return z.WithSubmit(A.Is(function(cG){return A.NotEmpty(cG);},"Please enter a valid URL.",B.op_LessMultiplyGreater(z.Return(function(cH){return cH;}),z.Yield(cF))));},view:function(cI,cJ){var cK,cN;cK=l.add(C.input("text",function(cL){return cL;},function(cM){return cM;},cI),j.ofArray([i.Attr().Class("form-control"),i.Attr().NewAttr("id","uri"),k.Attr().NewAttr("autofocus","autofocus"),k.Attr().NewAttr("placeholder","example.com")]));cN=function(){return function(cP){if(cP.KeyCode===13){f("#uri").blur();return f("#review-btn").click();}else{return null;}};};D.Events().OnKeyUp(cN,cK);return l.add(i.Div(j.ofArray([i.Attr().Class("input-group input-group-lg"),i.Attr().NewAttr("id","uri-input")])),j.ofArray([cK,l.add(i.Span(j.ofArray([i.Attr().Class("input-group-btn")])),j.ofArray([l.add(C.SubmitValidate(cJ),j.ofArray([i.Attr().Class("btn btn-primary"),i.Attr().NewAttr("id","review-btn"),i.Attr().NewAttr("value","Review"),k.Attr().NewAttr("data-"+"loading-text","Please wait...")]))]))]));}},Violations:{displayErrors:function(cQ){return E["displayViolations'"]("errors-nav-tab",cQ,"errors-accordion");},displayViolations:function(cR,cS){var cT;cT=n.getElementById(cS);return m.iteri(function(cU){return function(cV){var cW,cX,cY;cW=cV.Position;if(cW.$==1){cY=cW.$0;cX=[$$.String(cY.Line),$$.String(cY.Column)];}else{cX=["NA","NA"];}cT.appendChild(E.violationPanel(cV,cU,cS,cX[0],cX[1]).Body);return;};},cR);},"displayViolations'":function(cZ,c0,c1){r.updateTabHeader(cZ,$$.String(c0.get_Length()));return E.displayViolations(c0,c1);},displayWarnings:function(c2){return E["displayViolations'"]("warnings-nav-tab",c2,"warnings-accordion");},seoInfo:function(c3,c4){return l.add(i.Div(j.ofArray([i.Attr().Class("row seo-info")])),j.ofArray([i.Div(j.ofArray([i.Attr().Class("col-md-3 row-heading"),i.Text(c3)])),i.Div(j.ofArray([i.Attr().Class("col-md-9"),i.Text(c4)]))]));},violationPanel:function(c5,c6,c7,c8,c9){var c_,c$,da;c_=$$.String(c6);c$="#"+c7;da="error-"+c_;return l.add(i.Div(j.ofArray([i.Attr().Class("panel panel-default")])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("panel-heading")])),j.ofArray([l.add(i.H4(j.ofArray([i.Attr().Class("panel-title")])),j.ofArray([i.A(j.ofArray([i.HRef("#error-"+c_),k.Attr().NewAttr("data-"+"toggle","collapse"),k.Attr().NewAttr("data-"+"parent",c$),i.Text(c5.Heading)]))]))])),l.add(i.Div(j.ofArray([i.Attr().Class("panel-collapse collapse"),i.Attr().NewAttr("id",da)])),j.ofArray([l.add(i.Div(j.ofArray([i.Attr().Class("panel-body")])),j.ofArray([E.seoInfo("Line",c8),E.seoInfo("Column",c9),E.seoInfo("Description",c5.Description),E.seoInfo("Recommendation",c5.Recommendation)]))]))]));}},displayReview:function(db){var dc,dd;dc=db.Details;e.displayDetails(dc);u.displayKeywords(db.Keywords);r.displayHyperlinks(db.Hyperlinks);E.displayErrors(db.Errors);E.displayWarnings(db.Warnings);F.displayHeaders(db.Headers);dd=db.Speed;if(dd.$==1){c.displaySpeedReview(dd.$0);}return c.showReview(dc.RequestUri);},displaySpeedReview:function(de){var df;x.displayScreenshot(de);x.displayScore(de);x.displaySuggestions(de.Rules);df=de.Stats;x.displayResourcesStats(df);return x.displayBytesStats(df);},review:function(dg){return G.Start(G.Delay(function(){f("#alert").hide();H("#review-btn").button("loading");return G.Bind(I.Async("Sitelet:0",[dg]),function(di){if(di.$==1){c.showAlert("Downloading the URL failed.");return G.Return(null);}else{if(di.$==2){c.showAlert("The URL is not a HTML page.");return G.Return(null);}else{if(di.$==3){c.displayReview(di.$0);return G.Return(null);}else{c.showAlert("The URL is invalid.");return G.Return(null);}}}});}));},showAlert:function(dj){var dk,dl;H("#review-btn").button("reset");dl=i.Button(j.ofArray([i.Attr().Class("close"),i.Attr().NewAttr("aria-hidden","true"),i.Attr().NewAttr("type","button"),k.Attr().NewAttr("data-"+"dismiss","alert")]));dl.set_Html("&times;");dk=l.add(i.Div(j.ofArray([i.Attr().Class("alert alert-danger"),i.Attr().NewAttr("id","alert")])),j.ofArray([dl,i.Div(j.ofArray([i.Text(dj)]))]));return f(".jumbotron").append(dk.Body);},showReview:function(dm){var dn;dn=f("#page-header");if(dm.length<=30){dn.text("Review of "+dm);}else{dn.text("Review of "+c.trimUri(dm)).attr("title",dm);H("#page-header").tooltip(J);}f("#jumbotron").remove();f("#review").fadeIn();return H("body").scrollspy({target:"#affix-nav"});},substring:function(_do,dp){var dq;dq=function(dr){return K.fromCharCode(dr);};return L.concat("",m.map(function(ds){return K.fromCharCode(ds);},m.take(15,_do)))+"..."+L.concat("",m.map(dq,m.skip(dp-15,_do)));},trimUri:function(dt){var du;du=dt.length;return du<=30?dt:c.substring(dt,du);}}}}});$.OnInit(function(){a=$.Safe($$.Sitelet);b=$.Safe(a.Review);c=$.Safe(b.Js);d=$.Safe(c.UriPiglet);e=$.Safe(c.Details);f=$.Safe($$.jQuery);g=$.Safe($$.IntelliFactory.WebSharper);h=$.Safe(g.Html);i=$.Safe(h.Default);j=$.Safe(g.List);k=$.Safe(i.HTML5);l=$.Safe(h.Operators);m=$.Safe(g.Seq);n=$.Safe($$.document);o=$.Safe($$.google);p=$.Safe(o.visualization);q=$.Safe(p.DataTable);r=$.Safe(c.Hyperlinks);s=$.Safe(j.T);t=$.Safe(p.PieChart);u=$.Safe(c.Keywords);v=$.Safe(g.Operators);w=$.Safe(p.Table);x=$.Safe(c.Speed);y=$.Safe(g.Piglets);z=$.Safe(y.Piglet1);A=$.Safe(z.Validation);B=$.Safe(y.Pervasives);C=$.Safe(y.Controls);D=$.Safe(h.EventsPervasives);E=$.Safe(c.Violations);F=$.Safe(c.Headers);G=$.Safe(g.Concurrency);H=$.Safe($$.$);I=$.Safe(g.Remoting);J=$.Safe($$.options);K=$.Safe($$.String);return L=$.Safe(g.Strings);});$.OnLoad(function(){return;});}());
